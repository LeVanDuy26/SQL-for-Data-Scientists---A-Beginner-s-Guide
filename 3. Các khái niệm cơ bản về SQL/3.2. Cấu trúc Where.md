### I. Vị trí và Mục đích của Mệnh đề WHERE

1.  **Mục đích Cốt lõi:** Mệnh đề `WHERE` là phần của câu lệnh `SELECT` liệt kê các điều kiện được sử dụng để xác định **hàng nào trong bảng nên được bao gồm** trong tập hợp kết quả. Nói cách khác, chức năng chính của nó là **lọc** kết quả.
2.  **Vị trí trong Cấu trúc SELECT:** Mệnh đề `WHERE` nằm sau câu lệnh `FROM` và trước bất kỳ mệnh đề `GROUP BY`, `ORDER BY`, hoặc `LIMIT` nào.
3.  **Cơ chế Hoạt động:** SQL sử dụng **logic Boolean** (`TRUE` hoặc `FALSE`) để kiểm tra dữ liệu có sẵn dựa trên các điều kiện trong mệnh đề `WHERE` cho mỗi hàng. Chỉ những hàng mà sự kết hợp của các điều kiện đánh giá là `TRUE` mới được trả về.

### II. Ứng dụng trong Khoa học Dữ liệu

Tác giả Renée M. P. Teate nhấn mạnh rằng bà sử dụng mệnh đề `WHERE` trong **hầu hết mọi truy vấn** bà viết với tư cách là một nhà khoa học dữ liệu. Ứng dụng của nó bao gồm:

*   **Thu hẹp phạm vi:** Lọc để thu hẹp các danh mục bản ghi sẽ được hiển thị trong báo cáo.
*   **Lọc theo thời gian:** Lọc một tập dữ liệu theo **phạm vi ngày cụ thể** từ quá khứ, thường được sử dụng để huấn luyện mô hình dự đoán.
*   **Xác định tập hợp con:** Ví dụ, để in báo cáo về mọi thứ một khách hàng cụ thể đã mua, mệnh đề `WHERE` sẽ được sử dụng để chỉ định `customer_id` cần lọc.

### III. Lọc trên Nhiều Điều kiện (Boolean Logic)

Mệnh đề `WHERE` cho phép kết hợp nhiều điều kiện bằng các toán tử Boolean: `AND`, `OR`, hoặc `AND NOT`.

1.  **Toán tử OR:** Các điều kiện được nối bằng `OR` sẽ đánh giá là `TRUE` nếu **bất kỳ điều kiện nào** là `TRUE`. Nếu một danh sách dài các điều kiện được nối bằng `OR`, chỉ khi tất cả các điều kiện đó đều đánh giá là `FALSE` thì hàng mới không được trả về.
2.  **Toán tử AND:** Các điều kiện được nối bằng `AND` sẽ chỉ đánh giá là `TRUE` khi **tất cả các điều kiện** đều đánh giá là `TRUE`.
    *   **Lỗi logic phổ biến:** Cần lưu ý rằng một giá trị trong một hàng không thể đáp ứng hai điều kiện mâu thuẫn được nối bằng `AND` (ví dụ: `customer_id = 3 AND customer_id = 4` sẽ không trả về hàng nào).
3.  **Phạm vi Giá trị:** Có thể sử dụng `AND` để trả về các hàng có phạm vi giá trị, ví dụ: `WHERE customer_id > 3 AND customer_id <= 5`.
4.  **Kiểm soát thứ tự:** Có thể sử dụng **dấu ngoặc đơn `()`** để kiểm soát thứ tự các điều kiện được đánh giá, tương tự như trong biểu thức đại số, vì các điều kiện bên trong dấu ngoặc được đánh giá trước.

### IV. Các Phương pháp Lọc Khác

Ngoài các phép so sánh cơ bản (`=`, `>`, `<`), mệnh đề `WHERE` hỗ trợ nhiều cách lọc khác nhau:

1.  **Lọc Nhiều Cột:** Mệnh đề `WHERE` có thể áp đặt điều kiện bằng cách sử dụng giá trị trong **nhiều cột**.
2.  **`BETWEEN`:** Kiểm tra xem một giá trị (ví dụ: ngày tháng) có nằm **trong phạm vi chỉ định** hay không (bao gồm cả hai giá trị đầu và cuối).
3.  **`IN`:** So sánh giá trị trường với một **danh sách các giá trị** được phân tách bằng dấu phẩy. Đây là giải pháp thay thế cho việc sử dụng một danh sách dài các điều kiện `OR`.
4.  **`LIKE`:** Tìm kiếm các chuỗi **khớp một phần** bằng cách sử dụng **ký tự đại diện** (wildcard characters), ví dụ như `%` (dấu phần trăm) trong cú pháp MS SQL Server-style SQL, đại diện cho bất kỳ số lượng ký tự nào.
5.  **`IS NULL`:** Lọc các hàng có trường **trống (NULL)**. Rất quan trọng: `NULL` không phải là một giá trị, mà là sự vắng mặt của giá trị, do đó phải sử dụng `IS NULL` thay vì `=` `NULL` để lọc.
    *   Cần lưu ý rằng "blank" (chứa ký tự trống) không giống `NULL` (hoàn toàn trống).
6.  **Lọc bằng Truy vấn con (Subqueries):** Cho phép lọc dữ liệu dựa trên **danh sách các giá trị được trả về từ một truy vấn khác** (truy vấn bên trong), tạo ra một danh sách giá trị động để sử dụng trong so sánh `IN`.

### V. Cảnh báo quan trọng khi Lọc dữ liệu đã JOIN

Khi sử dụng `LEFT JOIN` (trả về tất cả các hàng từ bảng bên trái), cần đặc biệt lưu ý về vị trí của mệnh đề `WHERE`.

*   Nếu bạn áp dụng bộ lọc (`WHERE clause`) trên một trường từ bảng "bên phải" (`right side` table) mà không cho phép giá trị `NULL` cho trường đó, bạn sẽ vô tình làm thay đổi `LEFT JOIN` thành `INNER JOIN` (bằng cách loại bỏ các hàng không khớp từ bảng bên trái).
*   Để giữ lại các hàng từ bảng bên trái ngay cả khi không có kết quả khớp từ bảng bên phải, cần viết mệnh đề `WHERE` cho phép giá trị `NULL` trong trường lọc từ bảng bên phải, ví dụ: `WHERE (cp.market_date <> '2019-03-02' OR cp.market_date IS NULL)`.