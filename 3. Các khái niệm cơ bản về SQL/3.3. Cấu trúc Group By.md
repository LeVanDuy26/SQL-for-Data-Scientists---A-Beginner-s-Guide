### I. Vị trí và Cấu trúc Cú pháp

Mệnh đề `GROUP BY` được sử dụng để xác định cách dữ liệu sẽ được **tóm tắt**.

1.  **Vị trí:** Trong cấu trúc cú pháp `SELECT` hoàn chỉnh, mệnh đề `GROUP BY` nằm sau các mệnh đề `FROM` và `WHERE`, và trước các mệnh đề `HAVING` và `ORDER BY`:
    ```sql
    SELECT [columns to return]
    FROM [table]
    WHERE [conditional filter statements]
    GROUP BY [columns to group on]
    HAVING [conditional filter statements that are run after grouping]
    ORDER BY [columns to sort on]
    ```
2.  **Cú pháp:** Mệnh đề `GROUP BY` được theo sau bởi một danh sách tên cột, phân tách bằng dấu phẩy, chỉ ra cách người dùng muốn **tóm tắt** kết quả truy vấn.

### II. Mục đích: Xác định Mức độ Chi tiết (Granularity)

Mục đích cốt lõi của `GROUP BY` là thay đổi mức độ chi tiết (granularity) của tập dữ liệu từ các hàng dữ liệu thô chi tiết sang các hàng tóm tắt:

1.  **Chuyển đổi Dữ liệu Chi tiết:** Nếu truy vấn một bảng giao dịch như `customer_purchases` mà không có `GROUP BY`, kết quả sẽ là một hàng cho mỗi mục hàng (line item) được mua, dẫn đến các bản ghi trùng lặp nếu một khách hàng mua nhiều mặt hàng.
2.  **Đạt được Granularity Mong muốn:** Bằng cách thêm `GROUP BY` và chỉ định các cột (ví dụ: `market_date, customer_id`), người dùng có thể nhận được một hàng tóm tắt cho mỗi khách hàng trên mỗi ngày chợ, loại bỏ các bản ghi trùng lặp.
3.  **Hạn chế Cột trong SELECT:** Khi nhóm dữ liệu, tất cả các trường được liệt kê trong câu lệnh `SELECT` (ngoại trừ các hàm tổng hợp như `SUM` hoặc `COUNT`) **phải** được bao gồm trong mệnh đề `GROUP BY`. Nếu một cột không được tổng hợp được đưa vào `SELECT` mà không có trong `GROUP BY`, truy vấn sẽ không được tổng hợp ở cấp độ mong muốn, ví dụ: nếu nhóm theo khách hàng và ngày, nhưng cố gắng bao gồm ID nhà cung cấp (`vendor_id`), kết quả sẽ không được tổng hợp chính xác vì một khách hàng có thể mua hàng từ nhiều nhà cung cấp trong một ngày.

### III. Mối quan hệ với Hàm Tổng hợp (Aggregate Functions)

Mệnh đề `GROUP BY` là nền tảng cho việc sử dụng các hàm tổng hợp (aggregate functions), điều khiến SQL trở nên đặc biệt mạnh mẽ cho phân tích:

1.  **Kích hoạt Tổng hợp:** `GROUP BY` cho phép người dùng thêm các hàm như `SUM`, `COUNT`, `AVG`, `MIN`, và `MAX` vào câu lệnh `SELECT` để trả về các **tóm tắt** của dữ liệu cho mỗi nhóm. Ví dụ: có thể sử dụng hàm `COUNT(*)` để đếm số hàng trong mỗi nhóm, hoặc `SUM(quantity)` để tính tổng số lượng đã mua.
2.  **Tính toán và CASE Statements:** Các phép toán số học có thể được thực hiện *bên trong* các hàm tổng hợp, sau đó kết quả sẽ được tóm tắt theo nhóm. Thậm chí, các câu lệnh `CASE` có điều kiện có thể được đặt bên trong các hàm tổng hợp (`SUM(CASE WHEN...)`) để chỉ tổng hợp các giá trị thỏa mãn điều kiện cụ thể.

### IV. Bối cảnh Ứng dụng Rộng hơn

`GROUP BY` đóng vai trò quan trọng trong việc xây dựng các tập dữ liệu phức tạp cho mục đích phân tích và khoa học dữ liệu:

1.  **Xây dựng Tập dữ liệu Phân tích:** Mệnh đề này được sử dụng để tóm tắt dữ liệu ở mức độ chi tiết cần thiết cho việc tạo báo cáo hoặc chuẩn bị đầu vào cho các thuật toán học máy.
2.  **Kết hợp JOINs:** Việc tổng hợp bằng `GROUP BY` có thể được thực hiện trên các bảng đã được nối (`JOINed tables`). Khi tổng hợp dữ liệu từ nhiều bảng, điều quan trọng là phải nhóm theo tất cả các trường không được tổng hợp từ các bảng đã nối để duy trì sự nhất quán.
3.  **Phân tích Theo Thời gian:** Để phân tích theo khoảng thời gian lớn hơn (như hàng tuần thay vì hàng ngày), `GROUP BY` được sử dụng để nhóm dữ liệu theo các trường thời gian như `market_year` và `market_week`.
4.  **Sự khác biệt với DISTINCT:** Mặc dù sử dụng `SELECT DISTINCT` cũng có thể loại bỏ các bản ghi trùng lặp và đạt được cùng mức độ chi tiết như `GROUP BY` (ví dụ: có một hàng cho mỗi khách hàng trên mỗi ngày chợ), `GROUP BY` được sử dụng khi mục đích là **thêm các cột tóm tắt** (sử dụng các hàm tổng hợp) vào đầu ra.

### V. Mối quan hệ với Mệnh đề HAVING

Mệnh đề `HAVING` (nếu có) luôn được đặt sau `GROUP BY`. `HAVING` cho phép người dùng lọc các nhóm dữ liệu **sau khi** các hàm tổng hợp đã được áp dụng. Điều này khác với mệnh đề `WHERE`, vốn lọc các hàng riêng lẻ **trước** khi việc nhóm và tổng hợp diễn ra. Ví dụ: có thể sử dụng `HAVING` để lọc các nhà cung cấp có tổng số mặt hàng tồn kho lớn hơn 100.