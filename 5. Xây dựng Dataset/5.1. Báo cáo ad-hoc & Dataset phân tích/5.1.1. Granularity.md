### Granularity (Mức độ chi tiết) trong Xây dựng Bộ dữ liệu Phân tích

Granularity (được dịch là mức độ chi tiết hoặc ngữ cảnh dữ liệu) là một khái niệm trung tâm trong việc thiết kế các Bộ dữ liệu Phân tích (Analytical Datasets). Mức độ chi tiết của một bảng được định nghĩa bởi tập hợp các cột làm cho một hàng (row) trở nên duy nhất.

Việc lựa chọn Granularity là một quyết định chiến lược có ý nghĩa quan trọng đối với khả năng sử dụng và tính linh hoạt của bộ dữ liệu cho cả báo cáo Ad-hoc và các mục đích phân tích khác.

#### 1. Granularity Định đoạt Mức độ Phân tích Thấp nhất

Granularity mà bạn chọn để tổng hợp dữ liệu sẽ **quyết định mức độ chi tiết thấp nhất** mà bạn có thể lọc hoặc tổng hợp báo cáo dựa trên bộ dữ liệu đó.

* Nếu bạn xây dựng một bộ dữ liệu **tóm tắt** dữ liệu bán hàng theo  **tuần** , bạn sẽ **không thể** sử dụng bộ dữ liệu đó để tạo ra một báo cáo bán hàng hàng ngày (daily sales report), vì dữ liệu gốc đã được tổng hợp ở cấp độ cao hơn.
* Nếu bạn cần báo cáo về xu hướng theo giờ hoặc theo phút, bạn phải đảm bảo rằng tập dữ liệu của bạn có mức chi tiết ở cấp độ đó hoặc thấp hơn.

#### 2. Cân bằng giữa Tính Chi tiết Cao và Hiệu quả Truy vấn

Có một sự đánh đổi quan trọng giữa việc giữ Granularity ở mức cao nhất (chi tiết nhất) và hiệu quả của việc truy vấn:

* **Giữ mức chi tiết cao (Granular nhất):** Nếu công cụ báo cáo được sử dụng (ví dụ: Tableau) giúp việc tổng hợp dữ liệu trở nên đơn giản, bạn nên giữ bộ dữ liệu càng chi tiết càng tốt.
  * Giữ dữ liệu ở mức chi tiết nhất (ví dụ: mỗi hàng là một giao dịch mua hàng theo từng phút) cho phép người dùng **"khoan sâu" (drill down)** đến khoảng thời gian nhỏ nhất có sẵn trong dữ liệu.
* **Tổng hợp dữ liệu (Summarized):** Nếu bạn dự đoán rằng người dùng sẽ **thường xuyên** truy vấn bộ dữ liệu bằng SQL và tổng hợp nó ở một cấp độ cao hơn (ví dụ: hàng ngày), thì việc **tổng hợp sẵn** dữ liệu về mức độ đó có thể hợp lý.
  * Nếu bạn tạo một bộ dữ liệu tóm tắt doanh số theo  **ngày** , bạn có thể tái sử dụng nó như một **phím tắt (shortcut)** cho các yêu cầu báo cáo phổ biến (như hàng ngày hoặc hàng tuần), thay vì phải truy vấn dữ liệu thô (source data) và viết truy vấn tùy chỉnh cho những trường hợp đó.

Việc lựa chọn Granularity phù hợp cũng phụ thuộc vào nơi bộ dữ liệu sẽ được sử dụng:

* **Sử dụng trong công cụ BI (Tableau):** Các công cụ như Tableau có xu hướng tự động tổng hợp các số đo (measures) và cho phép tổng hợp dễ dàng theo các mốc thời gian khác nhau (như từ giây lên ngày), khuyến khích việc giữ dữ liệu càng chi tiết càng tốt.
* **Truy vấn bằng SQL thường xuyên:** Nếu bạn chủ yếu sẽ truy vấn bộ dữ liệu bằng SQL, bạn sẽ phải sử dụng mệnh đề `GROUP BY` và cấu trúc các truy vấn để tổng hợp ở cấp độ mong muốn **mỗi khi** sử dụng. Trong trường hợp này, việc tổng hợp trước dữ liệu đến mức độ được yêu cầu thường xuyên nhất (ví dụ: một hàng cho mỗi ngày) có thể giúp tiết kiệm thời gian.

#### 3. Granularity trong Bối cảnh Báo cáo Ad-hoc

Báo cáo Ad-hoc là một quá trình được mong đợi từ các nhà phân tích hoặc nhà khoa học dữ liệu, liên quan đến việc xây dựng các tập dữ liệu để trả lời các câu hỏi cụ thể từ các bên liên quan nghiệp vụ (business stakeholder).

Một nhà phân tích có kinh nghiệm sẽ thiết kế bộ dữ liệu không chỉ để trả lời câu hỏi trước mắt mà còn để dự đoán các  **câu hỏi tiếp theo (follow-up questions)** . Bằng cách bao gồm các phép tính, số đo (measures), và các chiều (dimensions) chi tiết, bộ dữ liệu kết quả sẽ có thể **tái sử dụng** cho các mục đích báo cáo trong tương lai.

Ví dụ, nếu một nhà quản lý hỏi về tổng doanh số tuần trước, nhà phân tích nên lường trước các câu hỏi tiếp theo như: "Doanh số giữa thị trường Thứ Tư và Thứ Bảy như thế nào?" hoặc "Bây giờ có thể chia nhỏ doanh số hàng tuần theo nhà cung cấp (vendor) không?".

Để trả lời những câu hỏi này, nhà phân tích cần chọn Granularity cho bộ dữ liệu (ví dụ: một hàng cho mỗi ngày, mỗi nhà cung cấp) để có thể lọc theo phạm vi ngày, hoặc nhóm theo nhà cung cấp (vendor) hoặc ngày trong tuần (`market_day`).

#### 4. Granularity trong Xây dựng Tập dữ liệu ML

Việc lựa chọn Granularity cũng rất quan trọng khi xây dựng tập dữ liệu cho các mô hình Học máy (ML):

* **Mô hình Chuỗi thời gian (Time Series Models):** Dữ liệu đào tạo cần một cột với ngày/giờ và một cột với giá trị được đo, với một hàng cho mỗi khoảng thời gian được chỉ định (giờ, ngày, tuần, tháng).
  * Ví dụ: Để dự báo doanh số hàng tuần, cần tổng hợp dữ liệu bán hàng về mức một hàng cho mỗi tuần. Việc này phải được thực hiện cẩn thận để tránh tổng hợp dữ liệu của cùng một tuần từ các năm khác nhau.
* **Mô hình Phân loại Nhị phân (Binary Classification Models):** Các thuật toán này yêu cầu dữ liệu đào tạo phải ở cùng mức độ tổng hợp và chi tiết (granularity) như dữ liệu sẽ được phân loại.
  * Ví dụ: Nếu mô hình dự đoán khả năng khách hàng quay lại mua hàng trong 30 ngày, mỗi hàng trong tập dữ liệu phải đại diện cho một lần mua hàng của khách hàng (customer per purchase date), ghi lại trạng thái của khách hàng và các đặc điểm liên quan **tại thời điểm** mua hàng đó.

Tóm lại, Granularity là yếu tố quyết định khả năng phân tích sâu nhất của một bộ dữ liệu. Nhà phân tích phải cân nhắc giữa việc giữ mức chi tiết tối đa cho sự linh hoạt và việc tổng hợp trước dữ liệu để cải thiện hiệu suất cho các báo cáo hoặc mô hình cụ thể.
