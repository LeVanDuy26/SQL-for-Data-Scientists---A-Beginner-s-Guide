### Bối cảnh: EDA và Khám phá Quan hệ Dữ liệu

Trong giai đoạn  **Phân tích Dữ liệu Khám phá (EDA)** , mục tiêu là làm quen và khám phá dữ liệu thô trực tiếp từ các bảng cơ sở dữ liệu. Khi được cấp quyền truy cập vào một cơ sở dữ liệu lần đầu tiên, một trong những câu hỏi quan trọng và hợp lý mà nhà phân tích cần đặt ra là: "Dữ liệu trong mỗi bảng liên quan đến các bảng khác như thế nào?".

Việc hiểu các mối quan hệ giữa các bảng là nền tảng vì nó cho phép nhà phân tích kết hợp dữ liệu từ nhiều nguồn để xây dựng các tập dữ liệu phức tạp hơn phục vụ cho báo cáo và phân tích.

#### 1. Sử dụng Sơ đồ Quan hệ Thực thể (ERD)

**Sơ đồ Quan hệ Thực thể (Entity-Relationship Diagram – ERD)** là một công cụ thiết yếu để khám phá cấu trúc cơ sở dữ liệu.

* **Định nghĩa Quan hệ:** ERD mô tả các mối quan hệ giữa các **thực thể (entities)** (tức là các bảng) trong cơ sở dữ liệu.
* **Tham khảo:** Khi bắt đầu một dự án phân tích, nếu may mắn, nhà phân tích có thể yêu cầu chuyên gia về chủ đề (SME) cung cấp ERD để tham khảo và hiểu các mối quan hệ giữa các bảng có liên quan.
* **Ví dụ trong Cơ sở dữ liệu Farmer’s Market:** Toàn bộ Cơ sở dữ liệu Farmer’s Market được mô tả bằng một ERD tổng thể.
* **Ký hiệu:** Trong ERD, một ký hiệu vô cực, chữ "N", hoặc "chân quạ" (crow’s feet) ở cuối đường nối hai bảng cho biết đó là phía "nhiều" (many side) của mối quan hệ một-nhiều (one-to-many relationship).

#### 2. Nhận dạng các Loại Quan hệ và Khóa (Keys)

Mối quan hệ giữa các bảng được xác định thông qua việc sử dụng **Khóa chính (Primary Keys)** và  **Khóa ngoại (Foreign Keys)** .

* **Khóa Chính (Primary Key):** Là cột hoặc tổ hợp các cột xác định duy nhất một hàng trong bảng. Giá trị của chúng phải là duy nhất và không được là NULL.
  * Việc xác định khóa chính là một trong những câu hỏi đầu tiên mà nhà phân tích cần tìm hiểu trong EDA để hiểu mức độ chi tiết (granularity) của bảng.
* **Khóa Ngoại (Foreign Key):** Khi khóa chính của một bảng được tham chiếu trong một bảng khác, nó được gọi là khóa ngoại. Khóa ngoại là cơ sở để thiết lập mối quan hệ giữa các bảng.
* **Quan hệ Một-nhiều (One-to-many):** Đây là một loại quan hệ phổ biến, ví dụ: một bệnh nhân có thể có nhiều cuộc hẹn, nhưng mỗi cuộc hẹn chỉ có một bệnh nhân. Trong trường hợp này, bảng ở phía "một" (ví dụ: `product_category`) chứa khóa chính, và bảng ở phía "nhiều" (ví dụ: `product`) chứa khóa ngoại.
* **Quan hệ Nhiều-nhiều (Many-to-many):** Đây là mối liên hệ mà các bản ghi ở mỗi phía có thể kết nối với nhiều bản ghi ở phía đối diện (ví dụ: nhiều tác giả có thể viết nhiều sách, và ngược lại). Để tạo mối quan hệ này trong cơ sở dữ liệu quan hệ, cần có một **bảng nối (junction table)** để ghi lại các cặp hàng liên quan.

#### 3. Sử dụng SQL JOINs để Khám phá và Kết hợp Dữ liệu

Khi mối quan hệ đã được xác định thông qua Khóa chính/Khóa ngoại, các lệnh **SQL JOIN** được sử dụng để kết hợp dữ liệu từ các bảng liên quan.

Trong EDA, việc khám phá mối quan hệ giữa các bảng bằng cách kết hợp chúng là cần thiết để xây dựng các tập dữ liệu chi tiết cho báo cáo và phân tích:

* **Kiểm tra Khả năng Kết nối:** Nhà phân tích cần xác định cách nối các bảng với nhau để tóm tắt các chi tiết cần thiết cho báo cáo.
  * Ví dụ: Câu hỏi về mùa vụ của rau củ quả cần dữ liệu từ ba bảng khác nhau (`product_category`, `product`, và `vendor_inventory`) và cần phải nối chúng lại với nhau.
* **Chọn loại JOIN:** Việc lựa chọn loại JOIN (LEFT, RIGHT, INNER) rất quan trọng và thường được kiểm tra trong giai đoạn EDA để đảm bảo dữ liệu được kết hợp chính xác.
  * **LEFT JOIN:** Đảm bảo tất cả các bản ghi từ bảng bên trái được giữ lại, ngay cả khi không có kết quả khớp ở bảng bên phải. Điều này hữu ích khi bạn muốn đưa vào các bản ghi không khớp (ví dụ: khách hàng chưa từng mua hàng).
  * **INNER JOIN:** Chỉ trả về các bản ghi có kết quả khớp ở cả hai bảng.
* **Khám phá bằng Cách Nối (Joining for Exploration):**
  * Sau khi xác định mức độ chi tiết (granularity) và phạm vi ngày của các bảng, nhà phân tích sẽ nối chúng lại với nhau để xem dữ liệu tương quan như thế nào. Ví dụ, nối dữ liệu tồn kho (`vendor_inventory`) và doanh số (`customer_purchases`) sau khi tổng hợp doanh số về cùng một mức độ chi tiết để so sánh chúng.
  * Nhà phân tích có thể nối các bảng "tra cứu" (lookup tables) như bảng `vendor` và `product` để chuyển đổi các ID thành các giá trị dễ đọc hơn (ví dụ: tên nhà cung cấp thay vì chỉ ID).

Tóm lại, trong EDA với SQL, việc khám phá mối quan hệ giữa các bảng—bằng cách xem xét ERD, xác định các khóa chính và khóa ngoại, và thực hiện các lệnh JOIN—là bước cơ bản để chuyển từ việc xem xét các bảng riêng lẻ sang việc xây dựng các tập dữ liệu phức tạp, kết hợp và tổng hợp phục vụ cho các câu hỏi phân tích cụ thể.
