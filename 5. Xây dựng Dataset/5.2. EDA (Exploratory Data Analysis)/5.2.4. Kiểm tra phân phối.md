### 1. Bối cảnh: EDA và Tầm quan trọng của Phân phối Giá trị

Phân tích Dữ liệu Khám phá (EDA) là giai đoạn đầu tiên và thường được thảo luận trong quy trình mô hình hóa dự đoán. Khi làm việc với dữ liệu lần đầu tiên, mục tiêu của nhà phân tích hoặc nhà khoa học dữ liệu là khám phá và làm quen với cấu trúc bảng và dữ liệu thô có sẵn.

Việc kiểm tra phân phối giá trị là một phần quan trọng của EDA nhằm trả lời các câu hỏi sau:

* **Phạm vi Giá trị:** "Phạm vi các giá trị có thể có trong cột này là gì?".
* **Tần suất Thống kê:** "Bao nhiêu hàng thuộc về mỗi danh mục?" (Đối với các giá trị phân loại - categorical values).
* **Hình dạng Phân phối:** "Hình dạng của phân phối thống kê là gì?" (Đối với các giá trị số liên tục hoặc rời rạc). Histograms (biểu đồ tần suất) đặc biệt hữu ích cho mục đích hình dung này trong giai đoạn khám phá.
* **Sự thay đổi theo thời gian:** Phân phối có thay đổi theo thời gian không (ví dụ: chia nhỏ theo năm tài chính)? Sự thay đổi này có thể chỉ ra các thay đổi trong quy trình nghiệp vụ hoặc lỗi dữ liệu.

### 2. Sử dụng `COUNT` để Xác định Quy mô và Tần suất

Lệnh `COUNT` trong SQL được sử dụng để xác định quy mô của dữ liệu và tần suất xuất hiện của các giá trị.

#### A. Xác nhận Quy mô Dữ liệu (`COUNT(*)`)

* Một trong những câu hỏi hợp lý đầu tiên là "Kích thước của các bảng là bao nhiêu?".
* Lệnh `SELECT COUNT(*)` được sử dụng để xác định **tổng số hàng** thực tế trong một bảng.
* Trong EDA, nhà phân tích có thể kiểm tra tổng số hàng được trả về để xem liệu nó có khớp với kỳ vọng hay không, giúp xác nhận **mức độ chi tiết (granularity)** của bảng và xem liệu truy vấn có vô tình tạo ra các bản ghi trùng lặp (duplicates) do lỗi `JOIN` hay không.

#### B. Xác minh Khóa Chính và Granularity (`COUNT(*)` với `GROUP BY`)

Để kiểm tra phân phối và xác nhận mức độ chi tiết của bảng, nhà phân tích sử dụng `COUNT(*)` kết hợp với `GROUP BY` và `HAVING`:

* **Xác nhận Tính duy nhất:** Bằng cách nhóm theo cột mà nhà phân tích nghi ngờ là khóa chính (ví dụ: `product_id`) và sử dụng mệnh đề `HAVING count(*) > 1`, truy vấn sẽ trả về bất kỳ nhóm nào có nhiều hơn một bản ghi.
  * Nếu truy vấn không trả về kết quả nào, điều đó xác nhận rằng cột đó là **duy nhất cho mỗi bản ghi** (tức là khóa chính) và bảng có mức độ chi tiết (granularity) là một hàng cho mỗi thực thể đó (ví dụ: một hàng cho mỗi sản phẩm).
* **Phân phối Danh mục:** Lệnh `COUNT` được sử dụng để đếm số lượng sản phẩm trong mỗi danh mục (nhóm theo `product_category_id`) để biết danh mục nào phổ biến nhất.

#### C. Sử dụng `COUNT` trong các Tính toán Phức tạp

`COUNT` cũng được sử dụng trong các tính toán nâng cao để tạo ra các tính năng phân tích:

* **Đếm Khách hàng Mới/Quay lại:** Trong các báo cáo phức tạp, `COUNT` được lồng trong các câu lệnh `CASE` để chỉ đếm các khách hàng đáp ứng điều kiện nhất định (ví dụ: khách hàng mới). Nếu điều kiện trong `CASE` không được đáp ứng, nó trả về `NULL`, và `COUNT` chỉ đếm các giá trị không phải `NULL`.
* **Đếm Tổng thể:** Khi sử dụng `GROUP BY`, `COUNT` sẽ đếm số hàng trong một nhóm.

### 3. Sử dụng `DISTINCT` để Khám phá Giá trị Độc nhất

Lệnh `DISTINCT` là công cụ chính trong EDA để khám phá các giá trị độc nhất trong một cột.

#### A. Khám phá Phạm vi Giá trị

Để làm quen với phạm vi giá trị trong một cột dường như chứa các giá trị chuỗi đại diện cho các danh mục (categorical string values), nhà phân tích có thể sử dụng `SELECT DISTINCT [column]`.

* Ví dụ: Kiểm tra trường `product_qty_type` để xem tất cả các loại số lượng sản phẩm (như "lbs" hoặc "unit") có sẵn là gì. Việc này giúp nhà phân tích ghi nhớ rằng một số sản phẩm có thể có giá trị `NULL` trong trường này.
* Việc khám phá này là cần thiết để nhà phân tích biết **những gì mong đợi** trong đầu ra báo cáo.

#### B. Đếm Giá trị Độc nhất (`COUNT(DISTINCT)`)

Khi cần đếm số lượng các thực thể duy nhất trong một nhóm, ngay cả khi dữ liệu thô chứa nhiều bản ghi cho thực thể đó, `COUNT(DISTINCT)` được sử dụng:

* **Đếm Sản phẩm/Khách hàng Khác nhau:** Thay vì chỉ đếm tổng số hàng (`COUNT(*)`) hoặc tổng số lượng (`SUM(quantity)`), nhà phân tích có thể muốn biết bao nhiêu **loại sản phẩm khác nhau** (`product_id`) đã được mua bởi mỗi khách hàng trên mỗi ngày thị trường. Lệnh này được viết là `COUNT(DISTINCT product_id)`.
* **Trong Báo cáo Nâng cao:** `COUNT(DISTINCT)` được sử dụng để đếm số lượng khách hàng duy nhất mỗi tuần, tránh việc đếm trùng lặp nếu một khách hàng đến chợ hai lần trong cùng một tuần.

Tóm lại, `COUNT` và `DISTINCT` là các lệnh cơ bản trong giai đoạn EDA với SQL. Chúng cho phép nhà phân tích nhanh chóng xác định kích thước dữ liệu, khám phá các giá trị duy nhất (đặc biệt là các giá trị phân loại), xác minh mức độ chi tiết (granularity) của các bảng, và đặt nền tảng cho việc xây dựng các tập dữ liệu tổng hợp chính xác.
