### 1. Granularity (Mức độ Chi tiết) trong EDA với SQL

Granularity, hay mức độ chi tiết, của một bảng được định nghĩa bởi tập hợp các cột làm cho một hàng (row) trở nên duy nhất.

Việc hiểu rõ Granularity của mỗi bảng là một yếu tố quan trọng và là bước nền tảng trong giai đoạn Khám phá Dữ liệu với SQL.

#### Granularity Xác Định Cấu trúc Dữ liệu

Khi bạn làm quen với các bảng dữ liệu trong cơ sở dữ liệu (ví dụ: cơ sở dữ liệu Farmer’s Market), một trong những câu hỏi hợp lý cần đặt ra thông qua truy vấn là:  **"Mức độ chi tiết (granularity) của mỗi bảng này là gì; điều gì làm cho một hàng trở nên duy nhất?"** .

* **Xác định Granularity:** Trong EDA, bạn có thể chạy một truy vấn để kiểm tra xem giả định của bạn về mức độ chi tiết có đúng hay không. Ví dụ, đối với bảng `product`, nhà phân tích có thể kiểm tra xem `product_id` có phải là khóa duy nhất không bằng cách nhóm (GROUP BY) theo `product_id` và trả về bất kỳ nhóm nào có nhiều hơn một bản ghi (`HAVING count(*) > 1`). Nếu không có kết quả nào được trả về, điều đó xác nhận rằng mức độ chi tiết của bảng đó là  **một hàng cho mỗi sản phẩm** .
* **Ví dụ về Bảng giao dịch:** Đối với bảng `vendor_inventory`, sau khi kiểm tra bằng cách nhóm theo `market_date`, `vendor_id`, và `product_id`, có thể xác nhận rằng bảng có mức độ chi tiết là  **một bản ghi cho mỗi ngày thị trường, nhà cung cấp và sản phẩm** .

#### Tầm quan trọng của Granularity

* **Lọc, Nhóm và Tóm tắt:** Việc hiểu rõ mức độ chi tiết của từng bảng là quan trọng để biết cách lọc (filter), nhóm (group), và tóm tắt (summarize) dữ liệu trong bảng đó, cũng như nối (join) nó với các bảng khác.
* **Ngăn ngừa Trùng lặp:** Trong quá trình phân tích, nếu bạn không hiểu rõ Granularity của bảng, bạn có thể vô tình tạo ra các bản ghi trùng lặp (duplicates) trong kết quả khi thực hiện các phép nối (JOINs).
* **Phân tích Lịch sử:** Việc kiểm tra Granularity cho phép nhà phân tích xác nhận cấu trúc của dữ liệu. Ví dụ, nếu bảng `product` chỉ có 23 sản phẩm, điều này cung cấp bối cảnh về quy mô của tập dữ liệu.
* **Xây dựng Bộ dữ liệu Phân tích:** Khi xây dựng các bộ dữ liệu phức tạp hơn, bạn cần đảm bảo rằng dữ liệu đã được **tổng hợp về cùng một mức độ chi tiết** của bảng chính (primary table) để tránh tạo ra các hàng trùng lặp. Trong ví dụ về việc so sánh hàng tồn kho (`vendor_inventory`) và doanh số (`customer_purchases`), doanh số đã được tổng hợp để đạt được cùng Granularity (một hàng cho mỗi ngày thị trường, nhà cung cấp và sản phẩm) trước khi nối hai tập dữ liệu này lại.

### 2. Khóa chính (Primary Key) trong EDA với SQL

Khóa chính là yếu tố cốt lõi định hình Granularity của một bảng và là cơ sở cho các mối quan hệ trong cơ sở dữ liệu.

#### Định nghĩa Khóa chính

* **Xác định Duy nhất:** **Khóa chính (primary key)** trong một bảng là một cột hoặc sự kết hợp của các cột mà  **xác định duy nhất một hàng** .
* **Tính Duy nhất và Bắt buộc:** Tổ hợp các giá trị trong các cột khóa chính phải là duy nhất cho mỗi bản ghi. Ngoài ra, giá trị của chúng không thể là NULL (trống rỗng).
* **Khóa chính Tạo sẵn:** Khóa chính có thể được tạo từ các giá trị tự nhiên (như Số ID Sinh viên) hoặc có thể là một giá trị số nguyên tự tăng (auto-incrementing integer value) được tạo ra bởi cơ sở dữ liệu, không mang ý nghĩa bên ngoài, nhằm đảm bảo tính duy nhất.
* **Khóa ngoại (Foreign Key):** Khi khóa chính của một bảng được tham chiếu trong một bảng khác, nó được gọi là  **khóa ngoại** . Khóa ngoại là cơ sở để thiết lập mối quan hệ giữa các bảng.

#### Vai trò của Khóa chính trong EDA

Việc xác định Khóa chính là một trong những câu hỏi đầu tiên mà nhà phân tích cần hỏi khi làm quen với một nguồn dữ liệu mới:  **"Tập hợp các trường nào tạo nên khóa chính cho bảng này?"** .

* **Xác nhận Khóa chính bằng truy vấn:** Nếu không có tài liệu về lược đồ cơ sở dữ liệu (schema) rõ ràng, nhà phân tích có thể kiểm tra giả định về khóa chính của mình (ví dụ: `product_id` trong bảng `product`) bằng cách sử dụng truy vấn `GROUP BY` và `HAVING` để đếm xem có bất kỳ tổ hợp nào xuất hiện nhiều hơn một lần không.
* **Khóa chính Tổng hợp (Composite Primary Key):** Khóa chính có thể là sự kết hợp của nhiều trường. Ví dụ, trong bảng nối (junction table) liên kết sách và tác giả (`Books-Authors Junction`), sự kết hợp của ISBN và ID Tác giả (Author ID) có thể được coi là khóa chính đa cột. Trong cơ sở dữ liệu Farmer’s Market, `vendor_inventory` sử dụng tổ hợp `market_date`, `vendor_id`, và `product_id` làm khóa chính.
* **Liên kết Bảng (JOINs):** Việc hiểu khóa chính và khóa ngoại là cơ sở để thực hiện các phép nối (JOINs). Các phép nối này cho phép nhà phân tích kết hợp dữ liệu từ các bảng liên quan để xây dựng các tập dữ liệu phức tạp hơn cho báo cáo Ad-hoc và phân tích.
